# 音感练习器

一个纯前端音感练习器网页应用，用于帮助用户练习绝对音感及音与音之间的关系。

## 功能特性

### 核心功能
- **五种练习模式**：单音识别、音程识别、旋律音程、和弦识别、音阶识别
- **三种输入方式**：虚拟键盘点击、麦克风输入、MIDI设备输入
- **灵活的音符范围设置**：支持自定义练习音符范围（C2-B6）
- **BPM速度控制**：滑动条和输入框两种方式调节节拍速度（30-180 BPM）
- **实时视觉反馈**：正确/错误答案的即时视觉反馈
- **暂停/继续功能**：支持练习过程中暂停和继续

### 技术特点
- 纯前端实现，无需后端支持
- 使用Web Audio API处理音频播放和音调生成
- 响应式设计，适配桌面端、平板及移动端
- 麦克风音高识别功能（基于自相关算法）
- MIDI设备连接支持
- 精确的节拍器计时系统（Web Audio API预调度）
- 毛玻璃/亚克力样式界面设计
- 优化的音频播放延迟，确保节拍和音高的准确性

## 项目结构

```
mol/
├── src/
│   ├── components/
│   │   ├── PianoKeyboard.vue      # 虚拟钢琴键盘组件
│   │   ├── SettingsPanel.vue      # 设置面板组件
│   │   └── StaffDisplay.vue       # 五线谱显示组件
│   ├── composables/
│   │   ├── useAudioEngine.js      # Web Audio API音频引擎
│   │   ├── useMIDIInput.js        # MIDI输入处理
│   │   └── useMicrophoneInput.js  # 麦克风音高识别
│   ├── App.vue                    # 主应用组件
│   └── main.js                    # 应用入口
├── public/
│   └── sounds/                   # 钢琴音频文件
├── index.html                     # HTML模板
├── vite.config.js                 # Vite配置
└── package.json                   # 项目依赖
```

## 使用方法

### 安装依赖
```bash
npm install
```

### 启动开发服务器
```bash
npm run dev
```

应用将在 http://localhost:3000/ 启动

### 构建生产版本
```bash
npm run build
```

## 部署方式

### GitHub Pages

1. 在GitHub上创建一个新仓库或使用现有仓库
2. 将代码推送到GitHub仓库
3. 进入仓库的Settings页面
4. 在左侧菜单中选择"Pages"
5. 在"Build and deployment"部分：
   - Source选择"Deploy from a branch"
   - Branch选择"main"（或"master"）
   - Folder选择"/ (root)"
6. 点击"Save"按钮
7. 等待几分钟后，你的应用将在 `https://<username>.github.io/<repository-name>/` 上线

### Vercel

1. 安装Vercel CLI（可选）：
```bash
npm i -g vercel
```

2. 在项目根目录运行：
```bash
vercel
```

3. 按照提示操作，Vercel会自动部署你的应用

### Netlify

1. 在Netlify上注册账号
2. 点击"Add new site"
3. 选择"Deploy manually"
4. 上传构建后的`dist`文件夹
5. 或者连接GitHub仓库，Netlify会自动部署

### 注意事项

- 确保在`vite.config.js`中配置了正确的`base`路径（如果部署到子目录）
- 静态资源（如音频文件）需要放在`public`文件夹中
- 部署前确保`npm run build`成功完成
- 首次部署可能需要等待几分钟才能访问

## 练习流程

1. **设置练习参数**
   - 选择音符范围（起始和结束音符，C2-B6）
   - 调整BPM速度（30-180 BPM）
   - 选择练习模式（单音/音程/旋律音程/和弦/音阶）
   - 选择输入方式（虚拟键盘/麦克风/MIDI）
   - 调整显示设置（虚拟键盘、五线谱、黑键）

2. **开始练习**
   - 点击"开始练习"按钮
   - 系统按照设定的BPM播放节拍器声音

3. **练习节拍**
   - 第一拍：播放题目声音（单音、音程、和弦或音阶）
   - 第二拍至第三拍：用户通过所选输入方式提交答案
   - 第四拍：系统公布正确答案并判断用户答案的正确性

4. **结果反馈**
   - 绿色闪烁：答案正确
   - 红色闪烁：答案错误
   - 显示正确答案和用户答案

5. **暂停/继续**
   - 练习过程中可以随时暂停
   - 暂停后可以继续练习

## 练习模式说明

### 单音识别
- 随机播放一个音符
- 用户需要识别并输入该音符的名称

### 音程识别
- 同时播放两个音符
- 用户需要识别并输入其中任意一个音符

### 旋律音程
- 依次播放两个音符
- 用户需要识别并输入其中任意一个音符

### 和弦识别
- 同时播放三个音符（三和弦）
- 支持大三和弦、小三和弦、减三和弦、增三和弦
- 用户需要识别并输入其中任意一个音符

### 音阶识别
- 依次播放音阶中的音符
- 支持大调音阶、小调音阶、五声音阶、布鲁斯音阶
- 用户需要识别并输入其中任意一个音符

## 输入方式说明

### 虚拟键盘
- 直接点击屏幕上的钢琴键盘
- 支持键盘快捷键：A-L对应白键，W-U对应黑键

### 麦克风输入
- 需要授予麦克风权限
- 实时识别音高并自动提交答案
- 基于自相关算法进行音高检测

### MIDI输入
- 需要连接MIDI设备
- 支持标准MIDI键盘
- 自动识别MIDI音符并提交答案

## 技术实现

### Web Audio API
- 使用AudioBufferSource播放真实钢琴音色
- 使用GainNode控制音量
- 支持音频文件预加载和缓存
- 精确的节拍器计时系统（预调度算法，消除累积误差）
- 音符播放时长与BPM同步（一整拍）
- 根据BPM自动截断音频文件，防止音频重叠

### 音高识别
- 使用自相关算法进行音高检测
- 支持实时音高识别
- 频率范围：50Hz - 2000Hz

### 响应式设计
- 使用CSS Grid和Flexbox布局
- 媒体查询适配不同屏幕尺寸
- 移动端优化的触摸交互
- 毛玻璃/亚克力样式界面设计

## 浏览器兼容性

- Chrome/Edge 90+
- Firefox 88+
- Safari 14+
- 需要支持Web Audio API和getUserMedia API

## 注意事项

- 麦克风输入需要HTTPS环境或localhost
- MIDI输入需要浏览器支持Web MIDI API
- 首次使用需要授予音频设备权限
- 建议使用耳机获得更好的音频体验

## 开发说明

### 代码风格
- 使用Vue 3 Composition API
- 组件化设计，职责分离
- 使用Composables复用逻辑

### 性能优化
- 使用requestAnimationFrame进行动画
- 音频上下文按需创建和释放
- 事件监听器及时清理

### 界面设计
- 毛玻璃/亚克力样式（Glassmorphism）
- 半透明背景配合模糊效果
- 自定义背景图片
- 响应式布局适配不同设备
- 清晰的视觉反馈系统

## 许可证

MIT License
